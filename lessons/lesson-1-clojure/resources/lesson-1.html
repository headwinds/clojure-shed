<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>experiments</title>
   <link rel="stylesheet" type="text/css" href="/css/level-1-style.css">
</head>

<body>
  <!-- TODO: replace this with something that matches your app style -->
<div class="wrapper">
  <h1 class='home'>Functional Programming</h1>
  <p>a common task in programming in manipulating lists.
    We can use functions such as map, filter, and reduce to transform existing lists into new lists.
  </p>
  <p>
    For instance, in this experiment featuring the
    <a href="https://www.businessinsider.com/lego-women-nasa-scientists-astronauts-kit-2017-10" target="_blank">women of NASA lego set</a>,
    we transform a list of scientists and prepare them for space flight.
  </p>

  <div>
    <h2 class='home_sub'>Map</h2>
    <div id="lego-box">
      <img src="/imgs/civilians.jpg" width="300px" />
      <img src="/imgs/rachael.jpg" width="90px" />
      <img src="/imgs/cockateil.jpg" width="70px" />
    </div>
    <div>
      Let's update this list to show that these women work at NASA
    </div>
    <div id="map-results"></div>
    <div>
      <h2 class='home_sub'>Clojure</h2>
      <xmp>
(defn map-scientists-to-agency
  "returns a list of scientists adding their agency"
  [agency-name]
  (let [scientists-with-agency
    (map (fn [value] {:name (value :name) :profession (value :profession) :agency agency-name})
      scientists)]
  {:status 200
   :body scientists-with-agency}))
      </xmp>
    </div>
    <div>
      <button id="btn" onclick="mapScientists()">map scientists</button>
    </div>
  </div>

  <hr />

  <div>
    <h2 class='home_sub'>Filter</h2>
    <div id="lego-box">
        <img src="/imgs/plans.jpg" width="200px" />
    </div>
    <div>
      Who should we send to space?
    </div>
    <div id="filter-results"></div>
    <div>
    <h2 class='home_sub'>Clojure</h2>
    <xmp>
(defn filter-scientists-by-profession
  "returns a list of scientists filtered by profession"
     [field profession scientists-with-agency]
     (let [scientists-filtered-by-profession
       (filter #(= (str/lower-case profession) (str/lower-case (field %))) scientists-with-agency)]
     {:status 200
      :body scientists-filtered-by-profession}))
    </xmp>
  </div>
    <div>
      <button id="btn" onclick="filterScientists()">filter astronauts</button>
    </div>
  </div>

  <hr />

  <div>
    <h2 class='home_sub'>Find</h2>
    <div id="lego-box">
      <img src="/imgs/rover.png" width="200px" />
    </div>
    <div>
      Who should we assign to visualize Rover data?
    </div>
    <div id="find-results"></div>
    <div>
    <h2 class='home_sub'>Clojure</h2>
    <xmp>
(defn find-scientist
  "returns the first scientist matching these profession and age arguments"
     [profession specialty]
     (let [found-scientist
             (first (filter (every-pred (comp #{specialty} :specialty)
                                        (comp #{profession} :profession))
                                        scientists))]
     {:status 200
      :body found-scientist}))
    </xmp>
  </div>
    <div>
      <button id="btn" onclick="findScientist()">find computer scientist</button>
    </div>
  </div>

  <hr />

  <div>
    <h2 class='home_sub'>Filter: Build Fleet</h2>
    <div id="lego-box">
      <img src="/imgs/vehicle.jpg" width="200px" />
      <img src="/imgs/vehicle.jpg" width="200px" />
    </div>
    <div>
      Let's build a crew map move the scientists onto two vechiles
    </div>
    <div>
      <div>
        <h2 class='home_sub'>Vehicle 1</h2>
        <div id="fleet-1-results">???</div>
      </div>
      <div>
        <h2 class='home_sub'>Vehicle 2</h2>
        <div id="fleet-2-results">???</div>
      </div>
    </div>
    <div>
    <h2 class='home_sub'>Clojure</h2>
    <xmp>
  (defn filter-crew [staff ship-id] (filter #(= (:ship %) ship-id) staff))

  (def fleet [{:ship "apollo" :crew (filter-crew scientists 1)}
              {:ship "dragon" :crew (filter-crew scientists 2)}])

  (defn get-fleet []
    {:status 200
     :body fleet})
    </xmp>
  </div>
    <div>
      <button id="btn" onclick="getFleet()">filter create crews</button>
    </div>
  </div>


</div>
  <script>

  //- GET scientists ------------------------------

  const getScientists = () => {
    fetch('/get-scientists')
      .then(function(response) {
        return response.json();
      })
      .then(function(scientists) {
        updateDomWithResults(scientists, "map-results")
      });
  }

  getScientists();

  //- MAP ------------------------------

  const updateDomWithResults = (response, elId) => {
    const mapResults = document.getElementById(elId);

    let results = "<ul>";
    response.map(colonist => {
      const li = `<li>${colonist.name} - ${colonist.profession} - ${colonist.agency}</li>`;
      results += li;
      })
    results += "</ul>";

    mapResults.innerHTML = results;
  }

  const mapScientists = () => {

    const data = {name: "NASA"};

    const config = {
        method: "POST", // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, cors, *same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, same-origin, *omit
        headers: {
            "Content-Type": "application/json; charset=utf-8",
            // "Content-Type": "application/x-www-form-urlencoded",
        },
        redirect: "follow", // manual, *follow, error
        referrer: "no-referrer", // no-referrer, *client
        body: JSON.stringify(data), // body data type must match "Content-Type" header
    }

    fetch('/map-scientists-to-agency', config)
      .then(function(response) {
        return response.json();
      })
      .then(function(scientistsWithAgencies) {
        console.log("map response: " , scientistsWithAgencies);
        updateDomWithResults(scientistsWithAgencies, "map-results")
      });
  }

  //- FILTER ------------------------------

  const filterScientists = () => {

    const data = {profession: "astRoNauNt"};

    const config = {
        method: "POST", // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, cors, *same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, same-origin, *omit
        headers: {
            "Content-Type": "application/json; charset=utf-8",
            // "Content-Type": "application/x-www-form-urlencoded",
        },
        redirect: "follow", // manual, *follow, error
        referrer: "no-referrer", // no-referrer, *client
        body: JSON.stringify(data), // body data type must match "Content-Type" header
    }

    fetch('/filter-scientists-by-profession', config)
      .then(function(response) {
        return response.json();
      })
      .then(function(scientistsFilteredByProfession) {
        console.log("filter response: " , scientistsFilteredByProfession);
        updateDomWithResults(scientistsFilteredByProfession, "filter-results")
      });
  }

  //- FIND ------------------------------

  const findScientist = () => {

    const data = {profession: "Computer Scientist", specialty: "Data Visualization"};

    const config = {
        method: "POST", // *GET, POST, PUT, DELETE, etc.
        mode: "cors", // no-cors, cors, *same-origin
        cache: "no-cache", // *default, no-cache, reload, force-cache, only-if-cached
        credentials: "same-origin", // include, same-origin, *omit
        headers: {
            "Content-Type": "application/json; charset=utf-8",
            // "Content-Type": "application/x-www-form-urlencoded",
        },
        redirect: "follow", // manual, *follow, error
        referrer: "no-referrer", // no-referrer, *client
        body: JSON.stringify(data), // body data type must match "Content-Type" header
    }

    fetch('/find-scientist', config)
      .then(function(response) {
        return response.json();
      })
      .then(function(foundScientist) {
        console.log("find response: " , foundScientist);
        foundScientist["agency"] = "NASA";
        updateDomWithResults([foundScientist], "find-results")
      });
  }

  //- FILTER BUILD FLET -------------------

  const getFleet = () => {
    fetch('/get-fleet')
      .then(function(response) {
        return response.json();
      })
      .then(function(fleet) {

        let displayScientistsInShipA = fleet[0]["crew"]
        let displayScientistsInShipB = fleet[1]["crew"]

        updateDomWithResults(displayScientistsInShipA, "fleet-1-results")
        updateDomWithResults(displayScientistsInShipB, "fleet-2-results")
      });
  }

  //- REDUCE ------------------------------

  const reduceScientists = () => {
    fetch('/reduce-scientists')
      .then(function(response) {
        return response.json();
      })
      .then(function(scientistsNotReadyYet) {
        // coming soon
      });
  }



  </script>
</body>
</html>
